{"version":3,"sources":["../src/hooks/useLocalVideo.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport useHuddle01 from './useHuddle01';\nimport type { CustomMediaKind } from '@huddle01/web-core/types';\nimport type { Producer } from '@huddle01/web-core/types';\n\nexport const useLocalVideo = (props?: {\n  onProduceStart?: (producer: Producer) => void;\n  onProduceClose?: (reason?: {\n    code: number;\n    tag: string;\n    message?: string;\n  }) => void;\n}) => {\n  const { huddleClient } = useHuddle01();\n\n  const localPeer = huddleClient.localPeer;\n\n  const [stream, setStream] = useState<MediaStream | null>(\n    localPeer.getStream({ label: 'video' }),\n  );\n\n  const handleStreamFetched = useCallback(\n    (data: {\n      mediaKind: CustomMediaKind;\n      stream: MediaStream;\n    }) => {\n      if (data.mediaKind === 'cam') {\n        setStream(data.stream);\n      }\n    },\n    [],\n  );\n\n  const handleStreamClosed = useCallback(\n    (data: {\n      label: string;\n      mediakind?: CustomMediaKind;\n      reason?: { code: number; tag: string; message?: string };\n    }) => {\n      if (data.label === 'video') {\n        setStream(null);\n\n        if (props?.onProduceClose) props?.onProduceClose(data.reason);\n      }\n    },\n    [props?.onProduceClose],\n  );\n\n  const handleStreamPlayable = useCallback(\n    (data: {\n      label: string;\n      producer: Producer;\n    }) => {\n      if (data.label === 'video') {\n        if (props?.onProduceStart) props?.onProduceStart(data.producer);\n      }\n    },\n    [props?.onProduceStart],\n  );\n\n  useEffect(() => {\n    localPeer.on('stream-fetched', handleStreamFetched);\n\n    localPeer.on('stream-playable', handleStreamPlayable);\n\n    localPeer.on('stream-closed', handleStreamClosed);\n\n    return () => {\n      localPeer.off('stream-fetched', handleStreamFetched);\n\n      localPeer.off('stream-playable', handleStreamPlayable);\n\n      localPeer.off('stream-closed', handleStreamClosed);\n    };\n  }, []);\n\n  const enableVideo = localPeer.enableVideo;\n\n  const disableVideo = localPeer.disableVideo;\n\n  const track = stream?.getVideoTracks()[0] || null;\n\n  const isVideoOn = stream ? true : false;\n\n  const replaceVideoStream = localPeer.replaceVideoStream;\n\n  const changeVideoSource = localPeer.changeVideoSource;\n\n  return {\n    stream,\n    track,\n    isVideoOn,\n    enableVideo,\n    disableVideo,\n    replaceVideoStream,\n    changeVideoSource,\n  };\n};\n"],"mappings":";;;;;AAAA,SAAS,aAAa,WAAW,gBAAgB;AAK1C,IAAM,gBAAgB,CAAC,UAOxB;AACJ,QAAM,EAAE,aAAa,IAAI,oBAAY;AAErC,QAAM,YAAY,aAAa;AAE/B,QAAM,CAAC,QAAQ,SAAS,IAAI;AAAA,IAC1B,UAAU,UAAU,EAAE,OAAO,QAAQ,CAAC;AAAA,EACxC;AAEA,QAAM,sBAAsB;AAAA,IAC1B,CAAC,SAGK;AACJ,UAAI,KAAK,cAAc,OAAO;AAC5B,kBAAU,KAAK,MAAM;AAAA,MACvB;AAAA,IACF;AAAA,IACA,CAAC;AAAA,EACH;AAEA,QAAM,qBAAqB;AAAA,IACzB,CAAC,SAIK;AACJ,UAAI,KAAK,UAAU,SAAS;AAC1B,kBAAU,IAAI;AAEd,YAAI,OAAO;AAAgB,iBAAO,eAAe,KAAK,MAAM;AAAA,MAC9D;AAAA,IACF;AAAA,IACA,CAAC,OAAO,cAAc;AAAA,EACxB;AAEA,QAAM,uBAAuB;AAAA,IAC3B,CAAC,SAGK;AACJ,UAAI,KAAK,UAAU,SAAS;AAC1B,YAAI,OAAO;AAAgB,iBAAO,eAAe,KAAK,QAAQ;AAAA,MAChE;AAAA,IACF;AAAA,IACA,CAAC,OAAO,cAAc;AAAA,EACxB;AAEA,YAAU,MAAM;AACd,cAAU,GAAG,kBAAkB,mBAAmB;AAElD,cAAU,GAAG,mBAAmB,oBAAoB;AAEpD,cAAU,GAAG,iBAAiB,kBAAkB;AAEhD,WAAO,MAAM;AACX,gBAAU,IAAI,kBAAkB,mBAAmB;AAEnD,gBAAU,IAAI,mBAAmB,oBAAoB;AAErD,gBAAU,IAAI,iBAAiB,kBAAkB;AAAA,IACnD;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,cAAc,UAAU;AAE9B,QAAM,eAAe,UAAU;AAE/B,QAAM,QAAQ,QAAQ,eAAe,EAAE,CAAC,KAAK;AAE7C,QAAM,YAAY,SAAS,OAAO;AAElC,QAAM,qBAAqB,UAAU;AAErC,QAAM,oBAAoB,UAAU;AAEpC,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}