{"version":3,"sources":["../src/hooks/useLocalAudio.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport useHuddle01 from './useHuddle01';\nimport type { CustomMediaKind } from '@huddle01/web-core/types';\nimport type { Producer } from '@huddle01/web-core/types';\n\nexport const useLocalAudio = (props?: {\n  onProduceStart?: (producer: Producer) => void;\n  onProduceClose?: (label: string) => void;\n  onProduceError?: () => void;\n}) => {\n  const { huddleClient } = useHuddle01();\n\n  const localPeer = huddleClient.localPeer;\n\n  const [stream, setStream] = useState<MediaStream | null>(\n    localPeer.getStream({ label: 'audio' }),\n  );\n\n  const handleStreamFetched = useCallback(\n    (data: {\n      mediaKind: CustomMediaKind;\n      stream: MediaStream;\n    }) => {\n      if (data.mediaKind === 'mic') {\n        setStream(data.stream);\n      }\n    },\n    [],\n  );\n\n  const handleStreamPlayable = useCallback(\n    (data: {\n      label: string;\n      mediaKind?: CustomMediaKind;\n      producer: Producer;\n    }) => {\n      if (data.label === 'audio') {\n        if (props?.onProduceStart) props?.onProduceStart(data.producer);\n      }\n    },\n    [props?.onProduceStart],\n  );\n\n  const handleStreamClosed = useCallback(\n    (data: {\n      label: string;\n      mediaKind?: CustomMediaKind;\n      reason?: { code: number; tag: string; message?: string };\n    }) => {\n      if (data.label === 'audio') {\n        setStream(null);\n\n        if (props?.onProduceClose) props?.onProduceClose(data.label);\n      }\n    },\n    [props?.onProduceClose],\n  );\n\n  useEffect(() => {\n    localPeer.on('stream-fetched', handleStreamFetched);\n\n    localPeer.on('stream-playable', handleStreamPlayable);\n\n    localPeer.on('stream-closed', handleStreamClosed);\n\n    return () => {\n      localPeer.off('stream-fetched', handleStreamFetched);\n\n      localPeer.off('stream-playable', handleStreamPlayable);\n\n      localPeer.off('stream-closed', handleStreamClosed);\n    };\n  }, []);\n\n  const enableAudio = localPeer.enableAudio;\n\n  const disableAudio = localPeer.disableAudio;\n\n  const track = stream?.getAudioTracks()[0] || null;\n\n  const isAudioOn = stream ? true : false;\n\n  const replaceAudioStream = localPeer.replaceAudioStream;\n\n  const changeAudioSource = localPeer.changeAudioSource;\n\n  return {\n    stream,\n    track,\n    isAudioOn,\n    enableAudio,\n    disableAudio,\n    replaceAudioStream,\n    changeAudioSource,\n  };\n};\n"],"mappings":";;;;;AAAA,SAAS,aAAa,WAAW,gBAAgB;AAK1C,IAAM,gBAAgB,CAAC,UAIxB;AACJ,QAAM,EAAE,aAAa,IAAI,oBAAY;AAErC,QAAM,YAAY,aAAa;AAE/B,QAAM,CAAC,QAAQ,SAAS,IAAI;AAAA,IAC1B,UAAU,UAAU,EAAE,OAAO,QAAQ,CAAC;AAAA,EACxC;AAEA,QAAM,sBAAsB;AAAA,IAC1B,CAAC,SAGK;AACJ,UAAI,KAAK,cAAc,OAAO;AAC5B,kBAAU,KAAK,MAAM;AAAA,MACvB;AAAA,IACF;AAAA,IACA,CAAC;AAAA,EACH;AAEA,QAAM,uBAAuB;AAAA,IAC3B,CAAC,SAIK;AACJ,UAAI,KAAK,UAAU,SAAS;AAC1B,YAAI,OAAO;AAAgB,iBAAO,eAAe,KAAK,QAAQ;AAAA,MAChE;AAAA,IACF;AAAA,IACA,CAAC,OAAO,cAAc;AAAA,EACxB;AAEA,QAAM,qBAAqB;AAAA,IACzB,CAAC,SAIK;AACJ,UAAI,KAAK,UAAU,SAAS;AAC1B,kBAAU,IAAI;AAEd,YAAI,OAAO;AAAgB,iBAAO,eAAe,KAAK,KAAK;AAAA,MAC7D;AAAA,IACF;AAAA,IACA,CAAC,OAAO,cAAc;AAAA,EACxB;AAEA,YAAU,MAAM;AACd,cAAU,GAAG,kBAAkB,mBAAmB;AAElD,cAAU,GAAG,mBAAmB,oBAAoB;AAEpD,cAAU,GAAG,iBAAiB,kBAAkB;AAEhD,WAAO,MAAM;AACX,gBAAU,IAAI,kBAAkB,mBAAmB;AAEnD,gBAAU,IAAI,mBAAmB,oBAAoB;AAErD,gBAAU,IAAI,iBAAiB,kBAAkB;AAAA,IACnD;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,cAAc,UAAU;AAE9B,QAAM,eAAe,UAAU;AAE/B,QAAM,QAAQ,QAAQ,eAAe,EAAE,CAAC,KAAK;AAE7C,QAAM,YAAY,SAAS,OAAO;AAElC,QAAM,qBAAqB,UAAU;AAErC,QAAM,oBAAoB,UAAU;AAEpC,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}