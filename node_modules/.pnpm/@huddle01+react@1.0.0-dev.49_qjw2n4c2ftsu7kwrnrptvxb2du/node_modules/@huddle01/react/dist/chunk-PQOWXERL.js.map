{"version":3,"sources":["../src/hooks/useDevices.ts"],"sourcesContent":["import type {\n  StreamPermissionsError,\n  CustomMediaDevice,\n} from '@huddle01/web-core/types';\n\nimport { useEffect, useState } from 'react';\n\nimport useHuddle01 from './useHuddle01';\n\ninterface Props {\n  type: CustomMediaDevice;\n  onPermissionGranted?: () => void;\n  onPermissionDenied?: () => void;\n}\n\nexport const useDevices = (props: Props) => {\n  const { type } = props;\n\n  const { huddleClient } = useHuddle01();\n\n  const localPeer = huddleClient.localPeer;\n\n  const deviceHandler = localPeer.deviceHandler;\n\n  const devices = deviceHandler.devices.get(type) || [];\n\n  const [preferredDeviceId, setPreferredDeviceId] = useState<string | null>(\n    deviceHandler.preferredDevices.get(type) || null,\n  );\n\n  const [, setDeviceCount] = useState<number>(devices.length);\n\n  useEffect(() => {\n    const handlePermissionGranted = (data: {\n      deviceKind: CustomMediaDevice;\n    }) => {\n      if (data.deviceKind === type) {\n        props.onPermissionGranted?.();\n      }\n    };\n\n    const handlePermissionDenied = (data: {\n      deviceKind: CustomMediaDevice;\n      error: StreamPermissionsError;\n    }) => {\n      if (data.deviceKind === type) {\n        props.onPermissionDenied?.();\n      }\n    };\n\n    const handleDeviceChange = () => {\n      const devices = deviceHandler.devices.get(type) || [];\n\n      setDeviceCount(devices.length);\n    };\n\n    const handlePrefferedDeviceChange = (data: {\n      deviceKind: CustomMediaDevice;\n      deviceId: string | null;\n    }) => {\n      if (data.deviceKind === type) {\n        setPreferredDeviceId(data.deviceId);\n        setDeviceCount(devices.length);\n      }\n    };\n\n    deviceHandler.once('permission-granted', handlePermissionGranted);\n\n    deviceHandler.once('permission-denied', handlePermissionDenied);\n\n    deviceHandler.on('device-change', handleDeviceChange);\n\n    deviceHandler.on('preferred-device-change', handlePrefferedDeviceChange);\n\n    return () => {\n      deviceHandler.off('permission-granted', handlePermissionGranted);\n\n      deviceHandler.off('permission-denied', handlePermissionDenied);\n\n      deviceHandler.off('device-change', handleDeviceChange);\n\n      deviceHandler.off('preferred-device-change', handlePrefferedDeviceChange);\n    };\n  }, []);\n\n  const getPermission = () => {\n    return deviceHandler.getMediaPermission({ mediaDeviceKind: type });\n  };\n\n  const fetchStream = deviceHandler.fetchStream;\n\n  const setPreferredDevice = (deviceId: string) => {\n    return deviceHandler.setPreferredDevice({\n      deviceKind: type,\n      deviceId,\n    });\n  };\n\n  const preferredDevice =\n    devices.find((device) => device.deviceId === preferredDeviceId) || null;\n\n  return {\n    devices,\n    preferredDeviceId,\n    preferredDevice,\n    fetchStream,\n    getPermission,\n    setPreferredDevice,\n  };\n};\n"],"mappings":";;;;;AAKA,SAAS,WAAW,gBAAgB;AAU7B,IAAM,aAAa,CAAC,UAAiB;AAC1C,QAAM,EAAE,KAAK,IAAI;AAEjB,QAAM,EAAE,aAAa,IAAI,oBAAY;AAErC,QAAM,YAAY,aAAa;AAE/B,QAAM,gBAAgB,UAAU;AAEhC,QAAM,UAAU,cAAc,QAAQ,IAAI,IAAI,KAAK,CAAC;AAEpD,QAAM,CAAC,mBAAmB,oBAAoB,IAAI;AAAA,IAChD,cAAc,iBAAiB,IAAI,IAAI,KAAK;AAAA,EAC9C;AAEA,QAAM,CAAC,EAAE,cAAc,IAAI,SAAiB,QAAQ,MAAM;AAE1D,YAAU,MAAM;AACd,UAAM,0BAA0B,CAAC,SAE3B;AACJ,UAAI,KAAK,eAAe,MAAM;AAC5B,cAAM,sBAAsB;AAAA,MAC9B;AAAA,IACF;AAEA,UAAM,yBAAyB,CAAC,SAG1B;AACJ,UAAI,KAAK,eAAe,MAAM;AAC5B,cAAM,qBAAqB;AAAA,MAC7B;AAAA,IACF;AAEA,UAAM,qBAAqB,MAAM;AAC/B,YAAMA,WAAU,cAAc,QAAQ,IAAI,IAAI,KAAK,CAAC;AAEpD,qBAAeA,SAAQ,MAAM;AAAA,IAC/B;AAEA,UAAM,8BAA8B,CAAC,SAG/B;AACJ,UAAI,KAAK,eAAe,MAAM;AAC5B,6BAAqB,KAAK,QAAQ;AAClC,uBAAe,QAAQ,MAAM;AAAA,MAC/B;AAAA,IACF;AAEA,kBAAc,KAAK,sBAAsB,uBAAuB;AAEhE,kBAAc,KAAK,qBAAqB,sBAAsB;AAE9D,kBAAc,GAAG,iBAAiB,kBAAkB;AAEpD,kBAAc,GAAG,2BAA2B,2BAA2B;AAEvE,WAAO,MAAM;AACX,oBAAc,IAAI,sBAAsB,uBAAuB;AAE/D,oBAAc,IAAI,qBAAqB,sBAAsB;AAE7D,oBAAc,IAAI,iBAAiB,kBAAkB;AAErD,oBAAc,IAAI,2BAA2B,2BAA2B;AAAA,IAC1E;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,gBAAgB,MAAM;AAC1B,WAAO,cAAc,mBAAmB,EAAE,iBAAiB,KAAK,CAAC;AAAA,EACnE;AAEA,QAAM,cAAc,cAAc;AAElC,QAAM,qBAAqB,CAAC,aAAqB;AAC/C,WAAO,cAAc,mBAAmB;AAAA,MACtC,YAAY;AAAA,MACZ;AAAA,IACF,CAAC;AAAA,EACH;AAEA,QAAM,kBACJ,QAAQ,KAAK,CAAC,WAAW,OAAO,aAAa,iBAAiB,KAAK;AAErE,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":["devices"]}